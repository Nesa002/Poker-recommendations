package rules.forward

import com.ftn.sbnz.model.models.Round;
import com.ftn.sbnz.service.services.HandService;
import com.ftn.sbnz.service.services.HandEvalQueryService;

global HandEvalQueryService handEvalService;
global HandService handService;
global Double min_bigger_raise;        
global Integer min_bigger_raise_blinds;   
global Integer bad_position_treshold;

rule "High Stakes Preminum Hand"
activation-group "high_stakes"
salience 10
when
    $r: Round()
    eval($r.getCurrentRaise() > (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() >= min_bigger_raise_blinds)
    eval(handEvalService.isHandAtLeast($r.getHand(), "Premium"))
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (High stake, premium hand)");
end

rule "High Stakes Good Position - Strong Hand"
activation-group "high_stakes"
salience 9
when
    $r: Round()
    eval($r.getCurrentRaise() > (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() >= min_bigger_raise_blinds)
    eval($r.getPlayerPosition() > bad_position_treshold)
    eval(handEvalService.isHandAtLeast($r.getHand(), "Strong"))
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (High stake, good position, strong hand)");
end

rule "High Stakes Good Position - Medium Hand with Strong Economy"
activation-group "high_stakes"
salience 8
when
    $r: Round()
    eval($r.getCurrentRaise() > (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() >= min_bigger_raise_blinds)
    eval($r.getPlayerPosition() > bad_position_treshold)
    eval(handEvalService.isHandAtLeast($r.getHand(), "Medium"))
    eval($r.getStrongEconomy())
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (High stake, good position, medium hand with strong economy)");
end

rule "High Stakes Good Position - Medium Hand with Aggressive Table"
activation-group "high_stakes"
salience 7
when
    $r: Round()
    eval($r.getCurrentRaise() > (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() >= min_bigger_raise_blinds)
    eval($r.getPlayerPosition() > bad_position_treshold)
    eval(handEvalService.isHandAtLeast($r.getHand(), "Medium"))
    eval(handService.isTableAggressive())
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (High stake, good position, medium hand with aggressive table)");
end

rule "High Stakes Bad Position"
activation-group "high_stakes"
salience 6
when
    $r: Round()
    
    eval($r.getCurrentRaise() > (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() >= min_bigger_raise_blinds)
    eval($r.getPlayerPosition() <= bad_position_treshold)
    eval($r.getStrongEconomy() && handEvalService.isHandAtLeast($r.getHand(), "Strong"))
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (High stake, bad position, strong hand/economy)");
end

rule "High Stakes Call Fallback"
activation-group "high_stakes"
salience -10
when
    $r: Round()
    eval($r.getCurrentRaise() > (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() >= min_bigger_raise_blinds)
then
    $r.setSuggestedAction("CALL");
    System.out.println("Action: CALL (High stakes fallback)");
end

// ================= Normal Stakes Raise =================

rule "Normal Stakes Strong Hand"
activation-group "normal_stakes"
salience 10
when
    $r: Round()
    eval($r.getCurrentRaise() <= (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() < min_bigger_raise_blinds)
    eval(handEvalService.isHandAtLeast($r.getHand(), "Premium"))
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (Normal stake, premium hand)");
end

rule "Normal Stakes Good Position - Strong Economy"
activation-group "normal_stakes"
salience 9
when
    $r: Round()
    eval($r.getCurrentRaise() <= (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() < min_bigger_raise_blinds)
    eval($r.getPlayerPosition() > bad_position_treshold)
    eval($r.getStrongEconomy())
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (Normal stake, good position, strong economy)");
end

rule "Normal Stakes Good Position - Aggressive Table with Playable Hand"
activation-group "normal_stakes"
salience 8
when
    $r: Round()
    eval($r.getCurrentRaise() <= (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() < min_bigger_raise_blinds)
    eval($r.getPlayerPosition() > bad_position_treshold)
    eval(handService.isTableAggressive() && handEvalService.isHandAtLeast($r.getHand(), "Playable"))
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (Normal stake, good position, aggressive table with playable hand)");
end

rule "Normal Stakes Good Position - Medium Hand"
activation-group "normal_stakes"
salience 7
when
    $r: Round()
    eval($r.getCurrentRaise() <= (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() < min_bigger_raise_blinds)
    eval($r.getPlayerPosition() > bad_position_treshold)
    eval(handEvalService.isHandAtLeast($r.getHand(), "Medium"))
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (Normal stake, good position, medium hand)");
end

rule "Normal Stakes Bad Position - Strong Economy with Medium Hand"
activation-group "normal_stakes"
salience 6
when
    $r: Round()
    eval($r.getCurrentRaise() <= (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() < min_bigger_raise_blinds)
    eval($r.getPlayerPosition() <= bad_position_treshold)
    eval($r.getStrongEconomy() && handEvalService.isHandAtLeast($r.getHand(), "Medium"))
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (Normal stake, bad position, strong economy with medium hand)");
end

rule "Normal Stakes Bad Position - Strong Hand"
activation-group "normal_stakes"
salience 5
when
    $r: Round()
    eval($r.getCurrentRaise() <= (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() < min_bigger_raise_blinds)
    eval($r.getPlayerPosition() <= bad_position_treshold)
    eval(handEvalService.isHandAtLeast($r.getHand(), "Strong"))
then
    $r.setSuggestedAction("RAISE");
    System.out.println("Action: RAISE (Normal stake, bad position, strong hand)");
end

rule "Normal Stakes Call Fallback"
activation-group "normal_stakes"
salience -10
when
    $r: Round()
    eval($r.getCurrentRaise() <= (min_bigger_raise * $r.getPot()) && $r.getCurrentRaise() < min_bigger_raise_blinds)
then
    $r.setSuggestedAction("CALL");
    System.out.println("Action: CALL (Normal stakes fallback)");
end