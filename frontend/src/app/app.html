<div class="container">
  <h1>Poker Decision Helper</h1>

  <div class="setup-section" *ngIf="!gameStarted">
    <h2 *ngIf="!overallWinner">Game Setup</h2>
    <div *ngIf="overallWinner" class="overall-winner-message">
        <h2>GAME OVER!</h2>
        <p>Winner: <strong>{{ overallWinner }}</strong></p>
        <p>Click "Reset Game Setup" to play again.</p>
    </div>

    <ng-container *ngIf="!overallWinner">
        <div>
          <label for="numPlayers">Number of Players:</label>
          <input id="numPlayers" type="number" [(ngModel)]="numberOfPlayersInput" min="2" placeholder="e.g., 4">
        </div>
        <div>
          <label for="startChips">Starting Chips:</label>
          <input id="startChips" type="number" [(ngModel)]="startingChipsInput" min="1" placeholder="e.g., 1000">
        </div>
        <div>
          <label for="position">Your Position (1 to {{ numberOfPlayersInput }}):</label>
          <input id="position" type="number" [(ngModel)]="playerPositionInput" min="1" [max]="numberOfPlayersInput" placeholder="e.g., 2">
        </div>
        <div>
          <label for="bbSize">Big Blind Size:</label>
          <input id="bbSize" type="number" [(ngModel)]="bigBlindSizeInput" min="1" placeholder="e.g., 10">
        </div>

        <div class="card-selection">
          <label>Your Hand:</label>
          <select [(ngModel)]="selectedCard1Rank">
            <option *ngFor="let rank of cardRanks" [value]="rank">{{ rank }}</option>
          </select>
          <select [(ngModel)]="selectedCard2Rank">
            <option *ngFor="let rank of cardRanks" [value]="rank">{{ rank }}</option>
          </select>
          <label class="suited-label">
            <input type="checkbox" [(ngModel)]="cardsAreSuited"> Suited
          </label>
        </div>

        <button (click)="startGame()">Start Game</button>
        <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
    </ng-container>

     <button (click)="resetGame()" *ngIf="overallWinner" style="margin-top: 20px;">Reset Game Setup</button>
  </div>

  <div class="game-section" *ngIf="gameStarted">
    <h2>Round {{ roundNum }}</h2>
    <p>Your Hand: <strong>{{ currentHand }}</strong> | Your Name: <strong>{{ ourPlayerName }}</strong></p>
    <p>Pot: {{ pot }} | BB: {{ bigBlindSize }} | Bet to Call: {{ currentRaise }}</p>

    <h3>Players & Chips & Bets:</h3>
    <ul>
      <li *ngFor="let player of players" [class.current-player]="player === getCurrentPlayerName()" [class.folded-player]="foldedPlayers.has(player)">
        {{ player }}: {{ playerChipsMap[player] }} chips
        <span class="bet-info">(Bet: {{ betsThisRound[player] || 0 }})</span>
        <span *ngIf="foldedPlayers.has(player)"> (FOLDED)</span>
        <span *ngIf="player === getCurrentPlayerName() && !roundOver"> <-- YOUR TURN</span>
      </li>
    </ul>

    <div class="action-section" *ngIf="!roundOver">
      <hr>
      <h3>Action for: {{ getCurrentPlayerName() }}</h3>

      <div *ngIf="isOurTurn()">
        <button (click)="getDecisionForOurPlayer()">Get Decision Suggestion</button>
        <p *ngIf="currentDecision">Backend Suggests: <strong>{{ currentDecision }}</strong></p>
        <p>Select your action:</p>
         <select [(ngModel)]="selectedAction">
           <option value="FOLD">Fold</option>
           <option value="CALL">Call / Check</option>
           <option value="RAISE">Raise</option>
           <option value="END">End Round</option>
         </select>
         <input *ngIf="selectedAction === 'RAISE'" type="number" [(ngModel)]="raiseAmountInput" placeholder="Raise Amount">
         <button (click)="handleAction()">Perform My Action</button>
      </div>

      <div *ngIf="!isOurTurn()">
         <select [(ngModel)]="selectedAction">
           <option value="FOLD">Fold</option>
           <option value="CALL">Call / Check</option>
           <option value="RAISE">Raise</option>
           <option value="END">End Round</option>
         </select>
         <input *ngIf="selectedAction === 'RAISE'" type="number" [(ngModel)]="raiseAmountInput" placeholder="Raise Amount">
         <button (click)="handleAction()">Perform Action for {{ getCurrentPlayerName() }}</button>
      </div>
       <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
    </div>

    <div class="winner-section" *ngIf="roundOver || didWeFold()">
       <hr>
       <h3 *ngIf="winner">Round Over! Winner: {{ winner }}</h3>
       <div *ngIf="!winner">
           <h3>Declare Winner (Round Ended or You Folded)</h3>
           <select [(ngModel)]="selectedWinner">
               <option value="">-- Select Winner --</option>
               <option *ngFor="let player of getActivePlayers()" [value]="player">
                   {{ player }}
               </option>
           </select>
           <button (click)="declareWinnerManually()">Award Pot</button>
       </div>
    </div>

    <div class="next-hand-selection" *ngIf="roundOver || didWeFold()">
        <hr>
        <h3>Select Hand for Next Round:</h3>
        <div class="card-selection">
          <label>Your Hand:</label>
          <select [(ngModel)]="selectedCard1Rank">
            <option *ngFor="let rank of cardRanks" [value]="rank">{{ rank }}</option>
          </select>
          <select [(ngModel)]="selectedCard2Rank">
            <option *ngFor="let rank of cardRanks" [value]="rank">{{ rank }}</option>
          </select>
          <label class="suited-label">
            <input type="checkbox" [(ngModel)]="cardsAreSuited"> Suited
          </label>
           <div *ngIf="selectedCard1Rank === selectedCard2Rank && cardsAreSuited" class="error-message" style="display: inline-block; margin-left: 10px;">
               Cannot select suited pair!
           </div>
        </div>
    </div>

    <hr>
    <button (click)="resetGame()">Reset Game Setup</button>
    <button (click)="startNextRound()" style="margin-left: 10px;"
            [disabled]="(!roundOver && !didWeFold()) || !!overallWinner">
        Start Next Round
    </button>
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  </div>
</div>